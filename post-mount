#!/bin/sh
# =============================================================
# AutoVPN Platform (AVP)
# Component : AVP-BOOT
# File      : post-mount
# Role      : post-mount helper (delegate Entware mount to AMTM)
# Version   : v1.0.7 (2026-02-16)
# Status    : stable
# =============================================================
#
# CHANGELOG
# - v1.0.7 (2026-02-16)
#   * CHG: delega montagem do Entware para /jffs/addons/amtm/mount-entware.mod (padrão AMTM)
# - v1.0.6 (2026-01-26)
#   * VERSION: bump patch (pos harden canônico)
# - v1.0.5 (2026-01-18)
#   * POLISH: padroniza SCRIPT_VER + set -u (ordem oficial) e remove linhas em branco desnecessarias
# - v1.0.4 (2025-12-26)
#   * CHORE: polimento preparatório pra GUI (suite alinhada)
# - v1.0.3 (2025-12-23)
#   * CHORE: consolidacao historica (Etapa B) + normaliza rotulos (BASE/STD/CHORE)
# - v1.0.2 (2025-12-23)
#   * CHORE: changelog hygiene (padrao STD/ADD + consistencia textual)
# - v1.0.1 (2025-12-23)
#   * STD: padroniza header + bloco CHANGELOG (Etapa A)
# - v1.0.0 (2025-12-23)
#   * BASE: bind mount do Entware para /opt no evento post-mount
# =============================================================

SCRIPT_VER="v1.0.7"
export PATH="/jffs/scripts:/opt/bin:/opt/sbin:/usr/bin:/usr/sbin:/bin:/sbin:${PATH:-}"
hash -r 2>/dev/null || true
set -u

# Entware mount (AMTM padrão)
if [ -f /jffs/addons/amtm/mount-entware.mod ]; then
  . /jffs/addons/amtm/mount-entware.mod
fi

logger -t AVP-BOOT "post-mount: Entware delegated to AMTM (mount-entware.mod)"
